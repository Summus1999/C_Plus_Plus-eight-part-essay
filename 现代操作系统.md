# **现代操作系统**

## 1.引论

整个计算机系统=硬件+软件

软件根据操作权限的不同分为**内核态**和**用户态**，用户态涉及某些敏感操作或者I/O操作是需要切换到内核态的。

操作系统对所有硬件资源都有访问权。

在嵌入式系统中，用户态和核心态的概念被模糊化。

抽象是管理复杂性的一个关键。抽象把任务划分为抽象的定义和实现，以及用这些抽象解决问题。

操作系统给程序隐藏了硬件。

操作系统**管理资源**的方式：

- 时间上复用：轮询使用资源
- 空间上复用：每个进程获取一部分资源实现内存分割

总的来说，操作系统是作为机器的一个扩展，同时由扮演了一个资源管理者的角色。

操作系统的历史：

- 一代：真空管和穿孔卡片
- 二代：晶体管和批处理系统，如FMS
- 三代：集成电路和多道程序设计，实现内存分割
- 四代：个人计算机，如mac OS和Windows NT
- 五代：移动计算机，Symbian OS，Android OS，iOS

计算机=处理器CPU+芯片+存储器(L2缓存+RAM+ROM)+磁盘(如固态硬盘)+I/O设备+总线

设备驱动程序装入操作系统有3种途径：

- 1.内核与驱动重新链接，重启系统：如UNIX
- 2.操作系统文件中设置入口，通知文件需要驱动重启系统：如Windows
- 3.操作系统运行时接收新驱动，无需重启：热插拔设备，动态加载

实现输入输出的3种方式：

- 系统调用：用户发出系统调用，内核翻译为对应的过程调用
- 驱动启动设备并让设备在操作完成时发出中断
- 为I/O使用特殊的DMA芯片

PCIe是PCI总线的继承者，使用**串行总线架构**，使用一条数据通路传递所有信息。

即插即用的工作：操作系统自动收集有关I/O设备的信息，集中赋予中断级别和I/O地址，通知每块卡使用的数值。

主板上装有BIOS，内有底层I/O软件，BIOS是长久存储的，出现错误时可通过操作系统更新。

**计算机启动过程**：

计算机启动时，先运行BIOS检查RAM数量，扫描总线上安装的所有设备，根据CMOS存储器中的设备清单决定设备的启动。操作系统询问BIOS获得配置信息。将所有驱动调入内核，初始化并创建对应进程，启动登录程序。

## 进程

进程的本质是一个正在执行的程序。进程拥有独立的地址空间，可用于读写和存放可执行程序、程序的数据以及堆栈。进程基本上是容纳运行一个程序所有信息的容器。

进程相关的信息都存放在进程表中。

进程的最大地址空间是小于主存的。如果使用**虚拟内存**技术则可以实现将部分地址空间装入主存，需要时用于交换。

操作系统使用目录保存文件。

读写文件前需要打开文件检查权限，权限许可则获得其**文件描述符**。获取权限失败会返回错误码。

UNIX中存在特殊文件，使得I/O设备看起来像文件一样，分为块特殊文件和字符特殊文件。

I/O设备的读写通过系统调用实现。

操作系统是进行系统调用的代码。

计算机科学中某种思想会随着技术的变化出现兴衰。

操作系统的**两大功能**：

- 为用户程序提供抽象
- 管理计算机资源

操作系统的结构：

- 单体系统：操作系统在内核态以单一程序运行
- 层次式系统：系统分层各司其职
- 微内核：操作系统分块，仅仅将微内核在内核态运行，如：qnx
- C/S模式：微内核的变体，客户端和服务端进程运行在不同的计算机上
- 虚拟机：克隆真实机器
- 外核：对机器进行分区，减少映像层

## 2.进程与线程

进程的创建是由4种事件触发的：

- 系统初始化
- 正在运行的程序执行了创建进程的系统调用
- 用户请求创建一个新进程
- 一个批处理作业的初始化
